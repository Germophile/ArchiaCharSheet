<!--
  To do:
  - Finish implementation of abilities:
  options (will probably have to make INDIVIDUAL hidden/shown options for each one *sigh*)
  edit/finish editing button for abilities (to get rid of the ugly dropdowns)
-->

Name: <input type="text" name="attr_character_name" title="@{character_name}"/> 
<button type="action" name="act_roll">ROLL</button>
<button type="action" name="act_edit">EDIT</button>
<br>

<div class="column left">
<h2>Attributes</h2>
<input type="hidden" value="" name="attr_attributeSelect" >
<input type="hidden" value="" name="attr_skillSelect" >
<input type="hidden" value="" name="attr_affinitySelect" >

<button class="d4 attrButton statButton brawnButton off" type="action" name="act_brawn/Die"></button>
Brawn <input type="number" class="editor hidden" name="attr_brawn" step="2" value="4" min="4" max="10" /><br>

  <button class="d4 attrButton statButton finesseButton off" type="action" name="act_finesse/Die"></button>
  Finesse <input type="number" class="editor hidden" name="attr_finesse" step="2" value="4" min="4" max="10" />
<br>

  <button class="d4 attrButton statButton knowledgeButton off" type="action" name="act_knowledge/Die"></button>
  Knowledge <input type="number" class="editor hidden" name="attr_knowledge" step="2" value="4" min="4" max="10" />
<br>
  <button class="d4 attrButton statButton wisdomButton off" type="action" name="act_wisdom/Die"></button>
  Wisdom <input type="number" class="editor hidden" name="attr_wisdom" step="2" value="4" min="4" max="10" />

  <h2>Skills</h2>

  <button class="d4 skillButton statButton athleticismButton off" type="action" name="act_athleticism/Die"></button>
  Athleticism <input type="number" class="editor hidden" name="attr_athleticism" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 skillButton statButton deductionButton off" type="action" name="act_deduction/Die"></button>
  Deduction <input type="number" class="editor hidden" name="attr_deduction" step="2" value="4" min="4" max="12" />
<br>
  
<button class="d4 skillButton statButton empathyButton off" type="action" name="act_empathy/Die"></button>
  Empathy <input type="number" class="editor hidden" name="attr_empathy" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 skillButton statButton focusButton off" type="action" name="act_focus/Die"></button>
  Focus <input type="number" class="editor hidden" name="attr_focus" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 skillButton statButton perceptionButton off" type="action" name="act_perception/Die"></button>
  Perception <input type="number" class="editor hidden" name="attr_perception" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 skillButton statButton performanceButton off" type="action" name="act_performance/Die"></button>
  Performance <input type="number" class="editor hidden" name="attr_performance" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 skillButton statButton recognitionButton off" type="action" name="act_recognition/Die"></button>
  Recognition <input type="number" class="editor hidden" name="attr_recognition" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 skillButton statButton skulduggeryButton off" type="action" name="act_skulduggery/Die"></button>
  Skulduggery <input type="number" class="editor hidden" name="attr_skulduggery" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 skillButton statButton stealthButton off" type="action" name="act_stealth/Die"></button>
  Stealth <input type="number" class="editor hidden" name="attr_stealth" step="2" value="4" min="4" max="12" />
<br>
</div>

<div class ="column middle">

  <h2>Affinities</h2>

  <button class="d4 affinityButton statButton divineButton off" type="action" name="act_divine/Die"></button>
Divine <input type="number" class="editor hidden" name="attr_divine" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 affinityButton statButton profaneButton off" type="action" name="act_profane/Die"></button>
Profane <input type="number" class="editor hidden" name="attr_profane" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 affinityButton statButton arcaneButton off" type="action" name="act_arcane/Die"></button>
Arcane <input type="number" class="editor hidden" name="attr_arcane" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 affinityButton statButton primevalButton off" type="action" name="act_primeval/Die"></button>
Primeval <input type="number" class="editor hidden" name="attr_primeval" step="2" value="4" min="4" max="12" />
<br>

<button class="d4 affinityButton statButton mundaneButton off" type="action" name="act_mundane/Die"></button>
Mundane <input type="number" class="editor hidden" name="attr_mundane" step="2" value="4" min="4" max="12" />
<br>

</div>

<div class ="column right">

<h2>Abilities</h2>

<fieldset class="repeating_abilities">
  
  <h3><span name="attr_ability"></span> <button class="editIcon" type="action" name="act_edit"></button></h3>
  Source: <span name="attr_abilitySource"></span><br>
  <span name="attr_abilityType"></span> (<span name="attr_abilitySubtype"></span>)
  <br> <span name="attr_ability_desc"></span>

  <input type="hidden" value=0 name="attr_abilityAPcost" />
  <input type="hidden" value=0 name="attr_abilitySPcost" />
  <input type="hidden" value="" name="attr_abilityType" class="abilityType"/>
  <input type="hidden" value="" name="attr_abilitySubtype" class="abilitySubtype"/>
  <input type="hidden" value="true" name="attr_editing" class="editing"/>
  <input type="hidden" value="divine" name="attr_abilitySource" class="abilitySource"/>

  <div class="editor">
    <input name="attr_ability" title="" type="text" value=""/>
    <!--repeating_abilities code below this will be modified by script-->
  <br>Source: <select name="attr_abilitySource">
    <option value="None" selected="selected"></option>
    <option value="Divine">Divine</option>
    <option value="Profane">Profane</option>
    <option value="Arcane">Arcane</option>
    <option value="Primeval">Primeval</option>
    <option value="Mundane">Mundane</option>
  </select>
  <br>Ability Type: 
    <span class="Divine">
        <select name="attr_abilityTypeDivine" class="abilityType Divine">
            <option value="None" selected="selected"></option>
            <option value="Attack">Attack</option>
            <option value="Augmentation">Augmentation</option>
            <option value="Communication">Communication</option>
            <option value="Divination">Divination</option>
            <option value="Rejuvenation">Rejuvenation</option>
            <option value="Scourge">Scourge</option>
        </select>
    </span>
    <span class="Profane">
        <select name="attr_abilityTypeProfane" class="abilityType Profane">
            <option value="None" selected="selected"></option>
            <option value="Attack">Attack</option>
            <option value="Cataclysm">Cataclysm</option>
            <option value="Communication">Communication</option>
            <option value="Illusion">Illusion</option>
            <option value="Psionics">Psionics</option>
            <option value="Scourge">Scourge</option>
        </select>
    </span>
    <span class="Arcane">
        <select name="attr_abilityTypeArcane" class="abilityType Arcane">
            <option value="None" selected="selected"></option>
            <option value="Attack">Attack</option>
            <option value="Augmentation">Augmentation</option>
            <option value="Communication">Communication</option>
            <option value="Creation">Creation</option>
            <option value="Illusion">Illusion</option>
            <option value="Magisprudence">Magisprudence</option>
        </select>
    </span>
    <span class="Primeval">
        <select name="attr_abilityTypePrimeval" class="abilityType Primeval">
            <option value="None" selected="selected"></option>
            <option value="Attack">Attack</option>
            <option value="Augmentation">Augmentation</option>
            <option value="Cataclysm">Cataclysm</option>
            <option value="Communication">Communication</option>
            <option value="Druidism">Druidism</option>
            <option value="Rejuvenation">Rejuvenation</option>
        </select>
    </span>
    <span class="Mundane">
        <select name="attr_abilityTypeMundane" class="abilityType Mundane">
            <option value="None" selected="selected"></option>
            <option value="Attack">Attack</option>
            <option value="Cataclysm">Cataclysm</option>
            <option value="Communication">Communication</option>
            <option value="Creation">Creation</option>
            <option value="Maneuvers">Maneuvers</option>
            <option value="Rejuvenation">Rejuvenation</option>
        </select>
    </span>

  <br>Ability Subtype: 
    <span class="Attack">
        <select name="attr_abilitySubtypeAttack" class ="abilitySubType Attack">
            <option value="None" selected="selected"></option>
            <option value="Attack">◩◩ Attack♢♢</option>
        </select>
    </span>
    <span class="Augmentation">
        <select name="attr_abilitySubtypeAugmentation" class ="abilitySubType Augmentation">
            <option value="None" selected="selected"></option>
            <option value="Shield">◩ Shield♢ (♢)</option>
            <option value="Buff">◩◩ Buff♢♢ (♢)</option>
        </select>
    </span>
    <span class="Cataclysm">
        <select name="attr_abilitySubtypeCataclysm" class ="abilitySubType Cataclysm">
            <option value="None" selected="selected"></option>
            <option value="Destruction">◩◩◩ Destruction</option>
            <option value="Suppression">◩◩◩ Suppression</option>
        </select>
    </span>
    <span class="Communication">
        <select name="attr_abilitySubtypeCommunication" class ="abilitySubType Communication">
            <option value="None" selected="selected"></option>
            <option value="Sending">◩ Sending♢</option>
            <option value="Comprehension">◩ Comprehension♢</option>
        </select>
    </span>
    <span class="Creation">
        <select name="attr_abilitySubtypeCreation" class ="abilitySubType Creation">
            <option value="None" selected="selected"></option>
            <option value="Fabricate">◩◩◩ Fabricate♢♢ (♢)</option>
            <option value="Imbue">◩ Imbue♢♢♢♢♢</option>
        </select>
    </span>
    <span class="Divination">
        <select name="attr_abilitySubtypeDivination" class ="abilitySubType Divination">
            <option value="None" selected="selected"></option>
            <option value="Augury">□□ Augury♢♢♢♢♢</option>
            <option value="Scrying">◩◩◩ Scrying♢♢ (♢)</option>
        </select>
    </span>
    <span class="Druidism">
        <select name="attr_abilitySubtypeDruidism" class ="abilitySubType Druidism">
            <option value="None" selected="selected"></option>
            <option value="Floromancy">◩ Floromancy♢♢</option>
            <option value="Faunomancy">◩◩ Faunomancy♢♢♢</option>
        </select>
    </span>
    <span class="Illusion">
        <select name="attr_abilitySubtypeIllusion" class ="abilitySubType Illusion">
            <option value="None" selected="selected"></option>
            <option value="Personal">◩◩ Personal♢♢ (♢)</option>
            <option value="Projected">◩◩◩ Projected♢♢♢ (♢)</option>
        </select>
    </span>
    <span class="Magisprudence">
        <select name="attr_abilitySubtypeMagisprudence" class ="abilitySubType Magisprudence">
            <option value="None" selected="selected"></option>
            <option value="Magic Sense">◩◩ Magic Sense♢</option>
            <option value="Teleportation">◩◩ Teleportation♢♢</option>
        </select>
    </span>
    <span class="Maneuvers">
        <select name="attr_abilitySubtypeManeuvers" class ="abilitySubType Maneuvers">
            <option value="None" selected="selected"></option>
            <option value="Exploits"> Exploits</option>
            <option value="Stunts"> Stunts</option>
        </select>
    </span>
    <span class="Psionics">
        <select name="attr_abilitySubtypePsionics" class ="abilitySubType Psionics">
            <option value="None" selected="selected"></option>
            <option value="Telepathy"> Telepathy</option>
            <option value="Telekinesis"> Telekinesis</option>
        </select>
    </span>
    <span class="Rejuvenation">
        <select name="attr_abilitySubtypeRejuvenation" class ="abilitySubType Rejuvenation">
            <option value="None" selected="selected"></option>
            <option value="HP"> HP</option>
            <option value="Mild Conditions"> Mild Conditions</option>
        </select>
    </span>
    <span class="Scourge">
        <select name="attr_abilitySubtypeScourge" class ="abilitySubType Scourge">
            <option value="None" selected="selected"></option>
            <option value="Against Skill Checks"> Against Skill Checks</option>
            <option value="Status Condition"> Status Condition</option>
        </select>
    </span>

    <span class="Attack">
        <br>◩◩◩<input type="checkbox" name="lingeringDamage"> Lingering Damage (♢): power die damage/turn</input>
        <br>◩◩◩<input type="checkbox" name="ranged"> Ranged: attack at a maximum distance of 5 hex.</input>
        <br>◩<input type="checkbox" name="furtherRange"> Further Range: instead, 10 hex.</input>
        <br>◩◩◩<input type="checkbox" name="homingShot"> Homing Shot: attack without line of sight</input>
        <br>◩◩<input type="number" name="seasoned"  step="1" value="0" min="0" max="10"> Seasoned: reroll <= *1 on your φd when attacking.</input>
        <br>◩◩<input type="checkbox" name="piercing"> Piercing: ignore resistance to chosen damage type.</input>
        <br>□□<input type="number" name="burst"  step="1" value="0" min="0" max="10"> Burst: additional + *1φd damage</input>
    </span>
    <span class="Shield">
        <br>◩<input type="checkbox" name="barrier"> Barrier: Target adds φd to its defense rolls.</input>
        <br>◩◩◩<input type="number" name="protected"  step="1" value="0" min="0" max="10"> Protected: target is immune to *1 specified condition(s).</input>
        <br>◩◩<input type="checkbox" name="enveloped"> Enveloped: target is immune to environment effects.</input>
        <br>◩◩<input type="checkbox" name="ranged"> Ranged: shield at a maximum distance of 5 hex.</input>
        <br>◩◩<input type="number" name="sturdyShield"  step="1" value="0" min="0" max="10"> Sturdy Shield: reroll the added φd on a roll <= *1.</input>
        <br>□□<input type="number" name="absorb"  step="1" value="0" min="0" max="10"> Absorb: Target adds +*1φd</input>
    </span>
    <span class="Buff">
        <br>◩◩<input type="checkbox" name="battlecry"> Battlecry: Target adds your φd to its attack actions.</input>
        <br>◩◩<input type="number" name="steadyHand"  step="1" value="0" min="0" max="10"> Steady Hand: Target may reroll <= *1 on skill checks.</input>
        <br>◩◩◩<input type="checkbox" name="potency"> Potency: Target makes attack rolls and skill checks with advantage.</input>
        <br>◩◩◩<input type="checkbox" name="ranged"> Ranged: buff at a maximum distance of 5 hex.</input>
    </span>
    <span class="Destruction">
        <br>◩◩◩<input type="number" name="radius"  step="1" value="0" min="0" max="10"> Radius: +*1 hex radius in every direction.</input>
        <br>◩◩◩<input type="number" name="exclude"  step="1" value="0" min="0" max="10"> Exclude: *1 targets within radius ignore effect.</input>
        <br>□□□<input type="number" name="burst"  step="1" value="0" min="0" max="10"> Burst: additional + *1φd damage</input>
    </span>
    <span class="Suppression">
        <br>◩◩◩<input type="number" name="radius"  step="1" value="0" min="0" max="10"> Radius: +*1 hex radius in every direction.</input>
        <br>◩◩◩<input type="number" name="exclude"  step="1" value="0" min="0" max="10"> Exclude: *1 targets within radius ignore effect.</input>
        <br>◩◩◩<input type="checkbox" name="lingering"> Lingering (♢♢): """"""</input>
    </span>
    <span class="Sending">
        <br>◩◩<input type="checkbox" name="listening"> Listening: and receive a response.</input>
        <br>□<input type="checkbox" name="farSending"> Far Sending ♢: Instead, send a message to a creature anywhere on the same plane of existence</input>
        <br>◩◩<input type="checkbox" name="telepathic"> Telepathic: Instead, send a telepathic message.</input>
    </span>
    <span class="Comprehension">
        <br>◩<input type="checkbox" name="longTerm"> Long Term: Increase the duration to a day.</input>
        <br>◩◩<input type="checkbox" name="vocal"> Vocal ♢: Be able to speak the language.</input>
    </span>
    <span class="Fabricate">
        <br>◩◩<input type="number" name="enlarge"  step="1" value="0" min="0" max="10"> Enlarge ♢: x*5 ft3</input>
        <br>□□□<input type="checkbox" name="makePermanent"> Make Permanent ♢♢♢: object lasts beyond concentration. Costs +1 □/enlarge.</input>
    </span>
    <span class="Imbue">
        <br>□□<input type="number" name="longTerm"  step="1" value="0" min="0" max="10"> Long Term: The item remains imbued for *1 additional day.</input>
        <br>■<input type="checkbox" name="charge"> Charge: Adds +1 use to a transient created item.</input>
    </span>
    <span class="Augury">
        <br>□<input type="checkbox" name="familiarKnowing"> Familiar Knowing: Learn some state or property of a known object or person: life/death, location, etc.</input>
        <br>□□<input type="checkbox" name="strangerKnowing"> Stranger Knowing: Learn some state or property of a specified but unfamiliar object or person.</input>
        <br>□□□□<input type="checkbox" name="crypticKnowing"> Cryptic Knowing: Learn the answer to a more complex or cryptic question about the world: matters of gods and demons, creation, the distant past.</input>
    </span>
    <span class="Scrying">
        <br>◩<input type="number" name="distant"  step="1" value="0" min="0" max="10"> Distant: Scrying distance increases by x*10</input>
        <br>◩◩<input type="checkbox" name="objective"> Objective: Scry on a particular object, rather than a location</input>
        <br>◩◩◩<input type="checkbox" name="personable"> Personable: Scry on a particular person, rather than a location</input>
        <br>◩◩ Detailed: <input type="checkbox" name ="detailedSee">See</input>, <input type="checkbox" name ="detailedhear">hear</input>, <input type="checkbox" name ="detailedfeel">feel</input>, <input type="checkbox" name ="detailedtaste">taste</input>, or <input type="checkbox" name ="detailedsmell">smell</input> the target location.    </span>
    <span class="Floromancy">
        <br>◩◩◩<input type="number" name="control"  step="1" value="0" min="0" max="10"> Control (♢): take control of and determine the actions of *1 nearby plant.</input>
        <br>◩◩<input type="number" name="summon"  step="1" value="0" min="0" max="10"> Summon: Create 1 power level *1-1 plant in a space adjacent to you.</input>
    </span>
    <span class="Faunomancy">
        <br>◩◩◩<input type="number" name="control"  step="1" value="0" min="0" max="10"> Control (♢♢): take control of and determine the actions of *1 nearby beast.</input>
        <br>◩◩◩<input type="number" name="summon"  step="1" value="0" min="0" max="10"> Summon (♢): Create 1 power level *1-1 beast in a space adjacent to you.</input>
    </span>
    <span class="Personal">
        <br>◩ Detailed: The illusion has <input type="checkbox" name ="detailedmotion">motion</input>, <input type="checkbox" name ="detailedsound">sound</input>, or <input type="checkbox" name ="detailedscent">scent</input>, <input type="checkbox" name ="detailedandmasksthesame">and masks the same</input>.        <br>◩◩◩<input type="checkbox" name="versimilitude"> Versimilitude: The illusion convincingly mimics a person or environment/invisibility</input>
    </span>
    <span class="Projected">
        <br>◩ Detailed: The illusion has <input type="checkbox" name ="detailedmotion">motion</input>, <input type="checkbox" name ="detailedsound">sound</input>, or <input type="checkbox" name ="detailedscent">scent</input>, <input type="checkbox" name ="detailedandmasksthesame">and masks the same</input>.        <br>◩◩◩◩<input type="checkbox" name="versimilitude"> Versimilitude: The illusion convincingly mimics a person or environment</input>
    </span>
    <span class="Magic-Sense">
        <br>◩<input type="checkbox" name="understand"> Understand: Also know the specific nature/effect of the magic</input>
            </span>
    <span class="Teleportation">
        <br>◩<input type="number" name="increasedRange"  step="1" value="0" min="0" max="10"> Increased Range: Increase range by *5 hex</input>
        <br>□□□□□<input type="checkbox" name="specificLocation"> Specific Location ♢♢♢: Teleport to any location</input>
        <br>□<input type="number" name="companions"  step="1" value="0" min="0" max="10"> Companions: Bring *1 other creature(s) with you when you teleport.</input>
        <br>□□<input type="checkbox" name="teleporttoCircle"> Teleport to Circle ♢♢♢: Teleport yourself and any number of others to a teleportation circle whose sigil you know.</input>
        <br>■■<input type="checkbox" name="createCircle"> Create Circle ♢♢♢: Create a permanent teleportation circle at a location.</input>
    </span>
    <span class="Exploits">
    </span>
    <span class="Stunts">
    </span>
    <span class="Telepathy">
    </span>
    <span class="Telekinesis">
    </span>
    <span class="HP">
    </span>
    <span class="Mild-Conditions">
    </span>
    <span class="Against-Skill-Checks">
        <br><input type="checkbox" name="lingering"> Lingering: </input>
    </span>
    <span class="Status-Condition">
        <br><input type="checkbox" name="lingering"> Lingering: </input>
    </span>

    <!--repeating_abilities code above this will be modified by script-->
  <textarea name="attr_ability_desc"></textarea>
  </div>
  


  

</fieldset>

</div>

  <rolltemplate class="sheet-rolltemplate-test">
    <div class="sheet-template-container">
        <h3>{{roll1}} {{name}}</h3>
    </div>
</rolltemplate>

<script type="text/worker">
  on('clicked:roll', function() {
      getAttrs(["attributeSelect","skillSelect","affinitySelect","Brawn","Finesse","Knowledge","Wisdom","skillSelect","Athleticism","Deduction","Empathy","Focus","Perception","Performance","Recognition","Skulduggery","Stealth","Divine","Profane","Arcane","Primeval","Mundane"], function(values) {
          var name = "";
          var rollstring = "";
          const stats = ["attribute","skill","affinity"];
  
          for(var x in stats) {
              if(values[stats[x]+"Select"].length > 1) {
                  skillDie = values[values[stats[x]+"Select"]];
                  if(name.length > 0) {
                      name += "/";
                      rollstring += "+";
                  }
                  name += values[stats[x]+"Select"];
                  rollstring += "1d" + values[values[stats[x]+"Select"]];
              }
          }
  
          startRoll("&{template:test} {{name="+name+"}} {{roll1=[[" + rollstring + "]]}}", (results) => {
              finishRoll(
                  results.rollId
              );
          });
      });
  
  });
  
  on('clicked:edit', function() {
      $20('.editor').toggleClass("hidden");
  });
  
  function changeAttr(attr) {
      getAttrs([attr], function(values) {
          const attrClass = '.' + attr.toLowerCase() + 'Button';
          const dieArray = ["d4","d6","d8","d10","d12"];
          for(var x in dieArray) $20(attrClass).removeClass(dieArray[x]);
          $20(attrClass).addClass("d" + values[attr]);
      });
  }
  
  function attrSelect(type, attr) {
      type = type + "Select";
      getAttrs([type], function(values) {
          if(values[type] == attr) setAttrs({[type]: ""});
          else setAttrs({[type]: attr});
      });
  }
  
  on('change:brawn', function() {changeAttr('Brawn')});
  on('change:finesse', function() {changeAttr('Finesse')});
  on('change:knowledge', function() {changeAttr('Knowledge')});
  on('change:wisdom', function() {changeAttr('Wisdom')});
  
  on('change:athleticism', function() {changeAttr('Athleticism')});
  on('change:deduction', function() {changeAttr('Deduction')});
  on('change:empathy', function() {changeAttr('Empathy')});
  on('change:focus', function() {changeAttr('Focus')});
  on('change:perception', function() {changeAttr('Perception')});
  on('change:performance', function() {changeAttr('Performance')});
  on('change:recognition', function() {changeAttr('Recognition')});
  on('change:skulduggery', function() {changeAttr('Skulduggery')});
  on('change:stealth', function() {changeAttr('Stealth')});
  
  on('change:divine', function() {changeAttr('Divine')});
  on('change:profane', function() {changeAttr('Profane')});
  on('change:arcane', function() {changeAttr('Arcane')});
  on('change:primeval', function() {changeAttr('Primeval')});
  on('change:mundane', function() {changeAttr('Mundane')});
  
  on('clicked:brawn/Die', function() {attrSelect("attribute","Brawn")});
  on('clicked:finesse/Die', function() {attrSelect("attribute","Finesse")});
  on('clicked:knowledge/Die', function() {attrSelect("attribute","Knowledge")});
  on('clicked:wisdom/Die', function() {attrSelect("attribute","Wisdom")});
  
  on('clicked:athleticism/Die', function() {attrSelect("skill","Athleticism")});
  on('clicked:deduction/Die', function() {attrSelect("skill","Deduction")});
  on('clicked:empathy/Die', function() {attrSelect("skill","Empathy")});
  on('clicked:focus/Die', function() {attrSelect("skill","Focus")});
  on('clicked:perception/Die', function() {attrSelect("skill","Perception")});
  on('clicked:performance/Die', function() {attrSelect("skill","Performance")});
  on('clicked:recognition/Die', function() {attrSelect("skill","Recognition")});
  on('clicked:skulduggery/Die', function() {attrSelect("skill","Skulduggery")});
  on('clicked:stealth/Die', function() {attrSelect("skill","Stealth")});
  
  on('clicked:divine/Die', function() {attrSelect("affinity","Divine")});
  on('clicked:profane/Die', function() {attrSelect("affinity","Profane")});
  on('clicked:arcane/Die', function() {attrSelect("affinity","Arcane")});
  on('clicked:primeval/Die', function() {attrSelect("affinity","Primeval")});
  on('clicked:mundane/Die', function() {attrSelect("affinity","Mundane")});
  
  on('change:attributeSelect', function() {
      getAttrs(["attributeSelect"], function(values) {
          $20('.attrButton').removeClass("on");
          $20('.attrButton').addClass("off");
          var cssRef = '.' + values.attributeSelect.toLowerCase() + 'Button';
          $20(cssRef).addClass("on");
          $20(cssRef).removeClass("off");
      });
  });
  
  on('change:skillSelect', function() {
      getAttrs(["skillSelect"], function(values) {
          $20('.skillButton').removeClass("on");
          $20('.skillButton').addClass("off");
          var cssRef = '.' + values.skillSelect.toLowerCase() + 'Button';
          $20(cssRef).addClass("on");
          $20(cssRef).removeClass("off");
      });
  });
  
  on('change:affinitySelect', function() {
      getAttrs(["affinitySelect"], function(values) {
          $20('.affinityButton').removeClass("on");
          $20('.affinityButton').addClass("off");
          var cssRef = '.' + values.affinitySelect.toLowerCase() + 'Button';
          $20(cssRef).addClass("on");
          $20(cssRef).removeClass("off");
      });
  });
          
  on('sheet:opened', function(){
      getAttrs(["attributeSelect","skillSelect","affinitySelect","Brawn","Finesse","Knowledge","Wisdom","Athleticism","Deduction","Empathy","Focus","Perception","Performance","Recognition","Skulduggery","Stealth","Divine","Profane","Arcane","Primeval","Mundane"], function(values) {
          const dieArray = ["d4","d6","d8","d10","d12"];
          const statArray = ["Brawn","Finesse","Knowledge","Wisdom","Athleticism","Deduction","Empathy","Focus","Perception","Performance","Recognition","Skulduggery","Stealth","Divine","Profane","Arcane","Primeval","Mundane"];
          $20('.attrButton').removeClass("on");
          $20('.attrButton').addClass("off");
          for(var x in dieArray) $20('.attrButton').removeClass(dieArray[x]);
          var cssRef = '.' + values.attributeSelect.toLowerCase() + 'Button';
          $20(cssRef).addClass("on");
          $20(cssRef).removeClass("off");
          cssRef = '.' + values.skillSelect.toLowerCase() + 'Button';
          $20(cssRef).addClass("on");
          $20(cssRef).removeClass("off");
          cssRef = '.' + values.affinitySelect.toLowerCase() + 'Button';
          $20(cssRef).addClass("on");
          $20(cssRef).removeClass("off");
          for(var x in statArray) $20('.'+statArray[x].toLowerCase()+'Button').addClass("d" + values[statArray[x]]);
      });
  });

  <!--Repeating_abilities script:-->

  on("change:repeating_abilities:abilitySource", function() {
    getAttrs(["repeating_abilities_abilitySource","repeating_abilities_abilityType","repeating_abilities_abilitySubtype","repeating_abilities_abilityTypeDivine","repeating_abilities_abilityTypeProfane","repeating_abilities_abilityTypeArcane","repeating_abilities_abilityTypePrimeval","repeating_abilities_abilityTypeMundane"], function(values) {
        var source = values.repeating_abilities_abilitySource;
        var type = values["repeating_abilities_abilityType"+source];
        setAttrs({"repeating_abilities_abilityType":type});
    });
  });

  on("change:repeating_abilities:abilityType", function() {
    getAttrs(["repeating_abilities_abilityType","repeating_abilities_abilitySubtypeAttack","repeating_abilities_abilitySubtypeAugmentation","repeating_abilities_abilitySubtypeCataclysm","repeating_abilities_abilitySubtypeCommunication","repeating_abilities_abilitySubtypeCreation","repeating_abilities_abilitySubtypeDivination","repeating_abilities_abilitySubtypeDruidism","repeating_abilities_abilitySubtypeIllusion","repeating_abilities_abilitySubtypeMagisprudence","repeating_abilities_abilitySubtypeManeuvers","repeating_abilities_abilitySubtypePsionics","repeating_abilities_abilitySubtypeRejuvenation","repeating_abilities_abilitySubtypeScourge"], function(values) {
        var type = values.repeating_abilities_abilityType;
        var subtype = values["repeating_abilities_abilitySubtype"+type];
        setAttrs({"repeating_abilities_abilitySubtype":subtype});
    });
  });
  on("change:repeating_abilities:abilityTypeDivine", function() {
    getAttrs(["repeating_abilities_abilityTypeDivine"], function(values) {
      setAttrs({"repeating_abilities_abilityType":values.repeating_abilities_abilityTypeDivine});
    });
  });
  on("change:repeating_abilities:abilityTypeProfane", function() {
    getAttrs(["repeating_abilities_abilityTypeProfane"], function(values) {
      setAttrs({"repeating_abilities_abilityType":values.repeating_abilities_abilityTypeProfane});
    });
  });
  on("change:repeating_abilities:abilityTypeArcane", function() {
    getAttrs(["repeating_abilities_abilityTypeArcane"], function(values) {
      setAttrs({"repeating_abilities_abilityType":values.repeating_abilities_abilityTypeArcane});
    });
  });
  on("change:repeating_abilities:abilityTypePrimeval", function() {
    getAttrs(["repeating_abilities_abilityTypePrimeval"], function(values) {
      setAttrs({"repeating_abilities_abilityType":values.repeating_abilities_abilityTypePrimeval});
    });
  });
  on("change:repeating_abilities:abilityTypeMundane", function() {
    getAttrs(["repeating_abilities_abilityTypeMundane"], function(values) {
      setAttrs({"repeating_abilities_abilityType":values.repeating_abilities_abilityTypeMundane});
    });
  });
  on("change:repeating_abilities:abilitySubtypeAttack", function() {
    getAttrs(["repeating_abilities_abilitySubtypeAttack"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeAttack});
    });
  });
  on("change:repeating_abilities:abilitySubtypeAugmentation", function() {
    getAttrs(["repeating_abilities_abilitySubtypeAugmentation"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeAugmentation});
    });
  });
  on("change:repeating_abilities:abilitySubtypeCataclysm", function() {
    getAttrs(["repeating_abilities_abilitySubtypeCataclysm"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeCataclysm});
    });
  });
  on("change:repeating_abilities:abilitySubtypeCommunication", function() {
    getAttrs(["repeating_abilities_abilitySubtypeCommunication"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeCommunication});
    });
  });
  on("change:repeating_abilities:abilitySubtypeCreation", function() {
    getAttrs(["repeating_abilities_abilitySubtypeCreation"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeCreation});
    });
  });
  on("change:repeating_abilities:abilitySubtypeDivination", function() {
    getAttrs(["repeating_abilities_abilitySubtypeDivination"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeDivination});
    });
  });
  on("change:repeating_abilities:abilitySubtypeDruidism", function() {
    getAttrs(["repeating_abilities_abilitySubtypeDruidism"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeDruidism});
    });
  });
  on("change:repeating_abilities:abilitySubtypeIllusion", function() {
    getAttrs(["repeating_abilities_abilitySubtypeIllusion"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeIllusion});
    });
  });
  on("change:repeating_abilities:abilitySubtypeMagisprudence", function() {
    getAttrs(["repeating_abilities_abilitySubtypeMagisprudence"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeMagisprudence});
    });
  });
  on("change:repeating_abilities:abilitySubtypeManeuvers", function() {
    getAttrs(["repeating_abilities_abilitySubtypeManeuvers"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeManeuvers});
    });
  });
  on("change:repeating_abilities:abilitySubtypePsionics", function() {
    getAttrs(["repeating_abilities_abilitySubtypePsionics"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypePsionics});
    });
  });
  on("change:repeating_abilities:abilitySubtypeRejuvenation", function() {
    getAttrs(["repeating_abilities_abilitySubtypeRejuvenation"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeRejuvenation});
    });
  });
  on("change:repeating_abilities:abilitySubtypeScourge", function() {
    getAttrs(["repeating_abilities_abilitySubtypeScourge"], function(values) {
      setAttrs({"repeating_abilities_abilitySubtype":values.repeating_abilities_abilitySubtypeScourge});
    });
  });

  <!--/Repeating_abilities script-->

  on("clicked:repeating_abilities:edit", function(eventInfo) {
    rowID = eventInfo.sourceAttribute.split('_')[2]
    varName = "repeating_abilities_" + rowID + "_editing"
    getAttrs([varName], function(values) {
      if(values[varName] === "true") setAttrs({"repeating_abilities_editing":"false"});
      else setAttrs({"repeating_abilities_editing":"true"});
    }); 
  });

</script>


<!--
  on("clicked:repeating_abilities:edit", function(eventInfo) {
    rowID = eventInfo.sourceAttribute.split('_')[2]
    getAttrs(["repeating_abilities_abilityType","repeating_abilities_abilitySource","repeating_abilities_abilitySubType"], function(values) {
        $20('.edit.' + values.repeating_abilities_abilityType.toLowerCase()).toggleClass("hidden");
        $20('.edit.' + values.repeating_abilities_abilitySource.toLowerCase()).toggleClass("hidden");
        $20('.edit.' + values.repeating_abilities_abilitySubType.toLowerCase()).toggleClass("hidden");
        $20('.edit.abilitySource').toggleClass("hidden");
    });
});
-->














































